<div id="orders" class="page-layout carded fullwidth ">
  <div class="top-bg accent"></div>
  <div class="center" style="padding-top: 30px;">
      <!-- HEADER -->
      <div class="header accent" #saludo id="saludo" fxLayout="column" fxLayoutAlign="center center"
            fxLayout.gt-xs="row" fxLayoutAlign.gt-xs="space-between center" *ngIf="_visible">

          <!-- APP TITLE -->
          <div class="logo mb-24 mb-sm-0" 
                fxLayout="row" fxLayoutAlign=" center" style="display: block;width: 100%;">
             
              <p style="display: block; width: 100%; text-align: center;color: #003245; font-size: 24px;font-weight: bold;" class="logo-text h1" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">!Hola,  {{currentUser.nombres}} {{currentUser.apellidos}}<br/> <span style="font-size: 16px;">Aquí podrás consultar y realizar nuevas ofertas</span></p>
          </div>
          <!-- / APP TITLE -->

         

      </div>
      <!-- / HEADER -->
  <a href="/gestion-propuesta/oferta" target="_blank" class="link_basic btn-nuevo" mat-icon-button color="primary" >
      <mat-icon style="font-size: 15px;" aria-label="Example icon-button with a heart icon">add</mat-icon>
      Nueva oferta 
    </a>
    <div>
    
  

    <mat-accordion>
      <mat-expansion-panel class="filtro">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <!--Personal data-->
            Buscar por filtros
          </mat-panel-title>
          <mat-panel-description>
           <!--Type your name and age--> 
          </mat-panel-description>
        </mat-expansion-panel-header>

          <div class="row">
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <input autocomplete="off" matInput [(ngModel)]="_filtro.oportunidad" class="form-control" placeholder="Cód. Oportunidad"  name="salesforce"  >
                <span style="color: #2EA5B8;"  matSuffix># &nbsp;</span>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <input autocomplete="off" [(ngModel)]="_filtroCliente" matInput #cliente class="form-control" placeholder="Cliente"  name="cliente"  >
                <mat-icon style="font-size: 15px;color: #2EA5B8;" matSuffix>person_outlin &nbsp;</mat-icon>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-6">
              <mat-form-field color="accent" style="width: 100%;">
                <input autocomplete="off" [(ngModel)]="_filtro.descripcion" matInput #descripcion class="form-control" placeholder="Descripción"  name="descripcion"  >
                <mat-icon style="font-size: 15px;color: #2EA5B8;" matSuffix>description &nbsp;</mat-icon>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <mat-label class="font-normal">Complejidad</mat-label>
                <select matNativeControl [(ngModel)]="_filtro.complejidad"  name="tipocosto">
                </select>
                <span  matSuffix>&nbsp; &nbsp;</span>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <mat-label class="font-normal">Estado</mat-label>
                <select matNativeControl [(ngModel)]="_filtroEstado"  name="tipocompra">
                  <option value="0" selected>Seleccionar</option>
                  <option *ngFor="let cl of lstEstado" [ngValue]="cl.id">{{cl.descripcion}}</option>
                </select>
                <span  matSuffix>&nbsp; &nbsp;</span>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <input autocomplete="off"   matInput #input class="form-control" placeholder="Desde"  name="desde"  >
                <mat-icon style="font-size: 15px;color: #2EA5B8;" matSuffix>calendar_today &nbsp;</mat-icon>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-3">
              <mat-form-field color="accent">
                <input autocomplete="off"  matInput #input class="form-control" placeholder="Desde"  name="desde"  >
                <mat-icon style="font-size: 15px;color: #2EA5B8;" matSuffix>calendar_today &nbsp;</mat-icon>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              <mat-checkbox class="example-margin"  [(ngModel)]="checked" style="font-size: 12px;" >Visualizar las plantilla de proyectos de todos los preventas</mat-checkbox>
            </div>
            
          </div>
          <div class="row">
            
            <div class="col-xs-9">
              &nbsp;&nbsp;&nbsp;&nbsp;
            </div>
            <div class="col-xs-12 col-sm-3" style="text-align: right;">
              <button (click)="filtrarData()" style="background: linear-gradient(90deg, #2F9CB3 0%, #5AC4D9 100%);border-radius: 4px;padding: 5px 15px;color: #fff;font-size: 13px;min-width: 100px;" class="link_basic" mat-icon-button color="primary">
                Buscar
              </button>
            </div>
          </div>
      </mat-expansion-panel>
    </mat-accordion>

    <br/>
    <div class="row" style="display: block; width: 100%;margin: 0;">
      <div class="col-xs-6" style="padding-left: 0px;">        
        <mat-form-field appearance="outline" color="accent" class="search_" style="height: 40px;min-width: 60%;">
          <input #filter matInput placeholder="Buscar" style="font-size: 13px;">
          <mat-icon style="color: #ccc;" matSuffix>search</mat-icon>         
        </mat-form-field>
      </div>
      <div class="col-xs-6" style="text-align: right; padding-right: 0px;">
        <button (click)="descargar_excel()"
        style="background: linear-gradient(90deg, #009806 0%, #62CE0E 100%);border-radius: 10px;border: 0;padding: 5px 15px 0px 15px;color: #fff;font-size: 13px;" class="link_basic" mat-icon-button color="primary">
          <mat-icon style="font-size: 15px;">cloud_download</mat-icon>
          Descargar xls
      </button>
      </div>
    </div>
<br/>
    <mat-card>

      <div class="content-card" style="display: block;width: 100%; margin-top: 10px;">

        <div style="position: relative;width: 100%; text-align: right;">
          <mat-icon color style="cursor: pointer;color: #2EA5B8; position: relative;" (click)="loadData()">refresh</mat-icon>
        </div>

        <mat-table class="orders-table"
                      #table [dataSource]="dataSource"
                       matSort
                        class="mat-cell"
                       [@animateStagger]="{value:'50'}"
                       fusePerfectScrollbar>

                      <ng-container matColumnDef="menu" >
                          <mat-header-cell *matHeaderCellDef class="mat-column-menu">
                            
                          </mat-header-cell>

                        <mat-cell class="mat-column-menu" *matCellDef="let row; let i=index;">
                          <mat-menu #appMenu="matMenu">
                            <button style="font-size: 12px;" mat-menu-item><mat-icon style="font-size: 15px; margin:5px 0 0 0;">visibility</mat-icon> Ver historial de versiones</button>
                            <button style="font-size: 12px;" mat-menu-item><mat-icon style="font-size: 15px; margin:5px 0 0 0;">add</mat-icon> Generar nueva version</button>
                            <button style="font-size: 12px;" mat-menu-item><mat-icon style="font-size: 15px; margin:5px 0 0 0;">file_copy</mat-icon> Duplicar plantilla</button>
                            <button style="font-size: 12px;" mat-menu-item><mat-icon style="font-size: 15px; margin:5px 0 0 0;">clear</mat-icon> Anular plantilla de proyecto</button>
                            <button style="font-size: 12px;" mat-menu-item><mat-icon style="font-size: 15px; margin:5px 0 0 0;">show_chart</mat-icon> Seguimiento de estado</button>
                          </mat-menu>
                          
                          <a style="cursor:pointer;color: #2493B4;" mat-icon-button [matMenuTriggerFor]="appMenu">
                            <mat-icon>more_vert</mat-icon>
                          </a>
                         </mat-cell>
                      </ng-container>

                      <ng-container matColumnDef="codigo">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Código</mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.codigo}}</mat-cell>
                      </ng-container> 

                       <ng-container matColumnDef="version">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Versión</mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.version}}</mat-cell>
                      </ng-container>
                  
                      <ng-container matColumnDef="oportunidad">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Oportunidad</mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.oportunidad}}</mat-cell>
                      </ng-container>
                  
                      <ng-container matColumnDef="cliente">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.cliente.descripcion}}</mat-cell>
                      </ng-container>
                  
                      <ng-container matColumnDef="descripcion">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Descripción</mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.descripcion}}</mat-cell>
                      </ng-container>
                  
                      <ng-container matColumnDef="estado">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Estado</mat-header-cell>
                      <mat-cell  *matCellDef="let row" > <span [ngStyle]="{'background':row.estado.color}" class="clestado" >{{row.estado.descripcion}}</span> </mat-cell>
                      </ng-container>
                  
                      
                    
                  
                      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                      </mat-table>

                      <mat-paginator #paginator
                      [length]="dataSource.filteredData.length"
                      [pageIndex]="0"
                      [pageSize]="5"
                      [pageSizeOptions]="[5, 10, 25, 100]">
                      </mat-paginator>
      </div>
      
    </mat-card>



    </div>
      


    <table id="excel-table" style="display: none;"> 
      <tr>       
         <th>Codígo</th> 
         <th>Version</th>  
         <th> Oportunidad</th> 
         <th>Cliente</th>
         <th>Descripción</th>   
         <th>Estado</th>
      </tr>    
      <tr *ngFor="let ds of dataSource.renderedData">
         <td>{{ ds.codigo}}</td>  
         <td>{{ ds.version }}</td> 
         <td>{{ ds.oportunidad }}</td> 
         <td>{{ ds.cliente.descripcion }}</td>
         <td>{{ ds.descripcion }}</td> 
         <td>{{ ds.estado.descripcion }}</td>
      </tr> 
  </table>

  </div>
  <br/><br/><br/>
</div>


